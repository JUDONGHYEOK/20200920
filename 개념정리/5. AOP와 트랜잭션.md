## 5. AOP와 트랜잭션

---

### 1. AOP라는 패러다임

- AOP: 관점지향 프로그래밍 (관점=관심사)

- AOP가 추구하는 것은 관ㅅ미사의 분리

- AOP 는 개발자가 염두에 두어야 하는 일들은 별도의 고나심사로 분리하고 핵심 비즈니스 로직만을 작성할 것을 권장

- 개발자들은 핵심 비즈니스 로직에만 근거해서 코드를 작성하고 나머지는 어떤 관심사들과 결합할 것인지를 설정하는 것 만으로 모든 개발을 마칠 수 ㅣㅇㅆ게된다.

  1. AOP 용어들

     1. 개발자의 입장에서 AOP를 적용한다는 것은 기존의 코드를 수정하지 앟ㄴ고도 원하는 관심사들을 역을 수 있다는 점이다.

     2. Target : 개발자가 작성한 핵심 비즈니스 로직

     3. Proxy : 내부적으로 Target호출

     4. JoinPoint : Target 객체가 가진 메서드. 외부에서의 호출은 Proxy 객체를 통해서 Target 객체의 JoinPoint를 호출하는 방식, Target이 가진 여러메서드

     5. Poincut : 어떤 메서드에 관심사를 결합할 것인지 결정, 관심사와 비즈니스 로직이 결합되는 지점을 결정

     6. Aspect는 관심사 자체를 의미하는 추상명사 Advice는 Aspect를 구현한 코드

        | 구분                   | 설명                                                         |
        | ---------------------- | ------------------------------------------------------------ |
        | Before Advice          | Target의 JoinPoint를 호출하기 전에 실행되는 코드 코드의 실행 자체에는 관여 할 수 없다. |
        | After Returning Advice | 모든 실행이 정상적으로 이루어진 후에 동작하는 코드           |
        | After Throwing Advice  | 예외가 발생한 뒤에 동작하는 코드                             |
        | After Advice           | 정상적으로 실행되거나 예외가 발생헀을 때 구분 없이 실행되는 코드 |
        | Around Advice          | 메서드의 실행 자체를 제어할 수 있는 가장 강력한 코드 직접 대상 메서드를 호출하고 결과나 예외를 처리 할 수 있다. |

     7.  Pointcut

        | 구분                  | 설명                                                       |
        | --------------------- | ---------------------------------------------------------- |
        | execution(@execution) | 메서드를 기준으로 Pointcut을 설정합니다.                   |
        | within(@within)       | 특정한 타입을 기준으로 Pointcut을 설정                     |
        | this                  | 주어진 인터페이스를 구현한 객체를 대상으로 Pointcut을 설정 |
        | args(@args)           | 특정한 파라미터를 가지는 대상들만을 Pointcut으로 설정      |
        | @annotation           | 특정한 어노테이션이 적용된 대상들만을 Pointcut으로 설정    |

  2. AOP 테스트
     1. args를 이용한 파라미터 추적
        1. @Before("execution(\*org.zerock.service.SampleService.\*(..))")은 어떤 위치에 Advice를 적용할 것인지를 결정하는 Pointcut 
        2. 설정시에 args를 이용하면 간단히 파라미터를 구할 수 있다.
     2. @AfterThrowing
        1. 지정된 대상이 예외를 발생한 후에 동작하면서 문제를 찾을 수 있도록 도와준다.
     3. @Around와 ProceedingJoinPoint
        1. @Around는 직접 대상 메서드를 실행할 수 있는 권한을 갖고 있고, 메서드의 실행 전과 실행 후에 처리가 가능하다.
        2. ProceedingJoinPoint는 AOP의 대상이 되는 Target이나 파라미터 등을 파악할 뿐만 아니라, 직접 실행을 결정할 수도 있다.
        3. @Before 등과 달리 @Around가 적용되는 메서드의 경우네는 리턴 타입이 void가 아닌 타입으로 설정하고, 메서드의 실행결과 역시 직접 반환하는 형태로 작성해야만 한다.

  